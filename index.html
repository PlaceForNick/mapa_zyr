<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa z warstwÄ… GeoJSON i animacjÄ…</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ol/7.2.2/ol.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ol/7.2.2/ol.css">
    <script src="https://cdn.jsdelivr.net/npm/ol@7.2.2/dist/ol.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.2.2/ol.css">

    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        #map { width: 100%; height: 90vh; }
        #slider-container {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #year-slider {
            width: 300px;
            margin: 0 10px;
        }
    </style>
</head>
<body>

<div id="map"></div>
<div id="slider-container">
    Rok: <span id="year-label">1917</span>
    <input type="range" id="year-slider" min="1917" max="2025" value="1917" step="1">
</div>

<script>
    // ðŸ“Œ Rejestracja ukÅ‚adu EPSG:2180
    proj4.defs("EPSG:2180","+proj=tmerc +lat_0=0 +lon_0=19 +k=0.9993 +x_0=500000 +y_0=-5300000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");
    ol.proj.proj4.register(proj4);

    // ðŸ“Œ Mapa
    var map = new ol.Map({
        target: 'map',
        layers: [
            new ol.layer.Tile({ source: new ol.source.OSM() })
        ],
        view: new ol.View({
            center: ol.proj.transform([19, 52], 'EPSG:4326', 'EPSG:3857'),
            zoom: 6
        })
    });

    // ðŸ“Œ Kolory dla rÃ³Å¼nych wartoÅ›ci "OD"
    var colorMap = {
        1917.0: '#6f3d24',
        1944.0: '#9a5632',
        1972.0: '#c16b3f',
        1992.0: '#cd8966',
        2023.0: '#deb29b'
    };

    // ðŸ“Œ Stylowanie obiektÃ³w
    function getFeatureStyle(feature) {
        var year = parseInt(feature.get('OD')); // Konwersja na liczbÄ™
        var color = colorMap[year] || '#000000'; // DomyÅ›lny kolor
        return new ol.style.Style({
            stroke: new ol.style.Stroke({ color: color, width: 1 }),
            fill: new ol.style.Fill({ color: color })
        });
    }

    // ðŸ“Œ Warstwa wektorowa
    var vectorSource = new ol.source.Vector({
        url: 'layers/bud.geojson',
        format: new ol.format.GeoJSON({
            dataProjection: 'EPSG:2180',
            featureProjection: 'EPSG:3857'
        })
    });

    var vectorLayer = new ol.layer.Vector({
        source: vectorSource,
        style: getFeatureStyle
    });

    map.addLayer(vectorLayer);

    // ðŸ“Œ ObsÅ‚uga suwaka czasu
    var yearSlider = document.getElementById('year-slider');
    var yearLabel = document.getElementById('year-label');

    yearSlider.addEventListener('input', function () {
    var selectedYear = Number(this.value);
    yearLabel.textContent = selectedYear;

    // ðŸ”„ Filtrujemy obiekty
    vectorSource.getFeatures().forEach(function (feature) {
        var startYear = Number(feature.get('OD')) || 0;
        var endYear = Number(feature.get('DO')) || 2025; // DomyÅ›lnie do 2025 jeÅ›li brak wartoÅ›ci

        var isVisible = startYear <= selectedYear && endYear >= selectedYear;

        // âœ… Nowy obiekt stylu lub null (ukrycie obiektu)
        feature.setStyle(isVisible ? getFeatureStyle(feature) : new ol.style.Style({}));
    });
});

</script>

</body>
</html>
